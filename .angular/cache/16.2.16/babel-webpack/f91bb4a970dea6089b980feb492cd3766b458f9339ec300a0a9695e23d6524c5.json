{"ast":null,"code":"import { BehaviorSubject, of } from 'rxjs';\nimport { map, catchError, tap } from 'rxjs/operators';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nexport class EscolaService {\n  constructor(http) {\n    this.http = http;\n    this.dadosCarregados$ = new BehaviorSubject(null);\n    this.DATA_URL = 'assets/static/dados_escolas.json';\n    this.carregarDados();\n  }\n  /**\n   * Carrega dados do JSON\n   */\n  carregarDados() {\n    this.http.get(this.DATA_URL).pipe(tap(dados => console.log('✅ Dados carregados:', dados)), catchError(error => {\n      console.warn('⚠️ Erro ao carregar JSON, usando fallback:', error);\n      return of(this.getDadosFallback());\n    })).subscribe(dados => {\n      this.dadosCarregados$.next(dados);\n    });\n  }\n  /**\n   * Retorna observable dos dados\n   */\n  getDados() {\n    return this.dadosCarregados$.asObservable();\n  }\n  /**\n   * Retorna escolas por tipo\n   */\n  getEscolasPorTipo(tipo) {\n    return this.dadosCarregados$.pipe(map(dados => {\n      if (!dados) return [];\n      if (!tipo) return dados.escolas;\n      return dados.escolas.filter(escola => escola.tipo === tipo);\n    }));\n  }\n  /**\n   * Calcula médias por tipo\n   */\n  calcularMediasPorTipo() {\n    return this.dadosCarregados$.pipe(map(dados => {\n      if (!dados || !dados.escolas) return null;\n      const pei = dados.escolas.filter(e => e.tipo === 'PEI');\n      const regular = dados.escolas.filter(e => e.tipo === 'Regular');\n      const calcularMedia = (escolas, campo) => {\n        const valores = escolas.map(e => e[campo]).filter(v => v !== undefined && !isNaN(v));\n        return valores.length > 0 ? valores.reduce((a, b) => a + b, 0) / valores.length : 0;\n      };\n      return {\n        pei: {\n          count: pei.length,\n          total: pei.length,\n          escolas: pei,\n          frequencia_media: calcularMedia(pei, 'frequencia_2bi'),\n          rendimento_medio: calcularMedia(pei, 'rendimento_2bi'),\n          aprovacao_media: calcularMedia(pei, 'aprovacao'),\n          plataformas_media: calcularMedia(pei, 'uso_plataformas'),\n          score_medio: calcularMedia(pei, 'score_super_bi')\n        },\n        regular: {\n          count: regular.length,\n          total: regular.length,\n          escolas: regular,\n          frequencia_media: calcularMedia(regular, 'frequencia_2bi'),\n          rendimento_medio: calcularMedia(regular, 'rendimento_2bi'),\n          aprovacao_media: calcularMedia(regular, 'aprovacao'),\n          plataformas_media: calcularMedia(regular, 'uso_plataformas'),\n          score_medio: calcularMedia(regular, 'score_super_bi')\n        }\n      };\n    }));\n  }\n  /**\n   * Retorna resumo da rede\n   */\n  getResumoRede() {\n    return this.dadosCarregados$.pipe(map(dados => dados?.resumo_rede || null));\n  }\n  /**\n   * Dados de fallback caso o JSON não carregue\n   */\n  getDadosFallback() {\n    return {\n      resumo_rede: {\n        total_escolas: 2,\n        escolas_pei: 1,\n        escolas_regulares: 1,\n        score_medio_geral: 83.3,\n        score_medio_pei: 86.7,\n        score_medio_regular: 79.8,\n        frequencia_media_rede: 90.0,\n        rendimento_medio_rede: 7.2,\n        aprovacao_media_rede: 84.3,\n        uso_plataformas_medio: 83.4,\n        engajamento_medio: 4.2\n      },\n      escolas: [{\n        id: 'pei_edith_silveira',\n        nome: 'PEI EE Profª Edith Silveira Dalmaso',\n        tipo: 'PEI',\n        frequencia_1bi: 91.9,\n        frequencia_2bi: 93.0,\n        rendimento_1bi: 7.7,\n        rendimento_2bi: 7.6,\n        aprovacao: 87.8,\n        uso_plataformas: 90.0,\n        engajamento_docente: 4.5,\n        score_super_bi: 86.7,\n        classificacao: 'MUITO BOM'\n      }, {\n        id: 'ee_plinio_berardo',\n        nome: 'EE Profº Plínio Berardo',\n        tipo: 'Regular',\n        frequencia_1bi: 84.8,\n        frequencia_2bi: 87.0,\n        rendimento_1bi: 6.9,\n        rendimento_2bi: 6.8,\n        aprovacao: 80.9,\n        uso_plataformas: 76.7,\n        engajamento_docente: 3.8,\n        score_super_bi: 79.8,\n        classificacao: 'BOM'\n      }]\n    };\n  }\n  static {\n    this.ɵfac = function EscolaService_Factory(t) {\n      return new (t || EscolaService)(i0.ɵɵinject(i1.HttpClient));\n    };\n  }\n  static {\n    this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n      token: EscolaService,\n      factory: EscolaService.ɵfac,\n      providedIn: 'root'\n    });\n  }\n}","map":{"version":3,"names":["BehaviorSubject","of","map","catchError","tap","EscolaService","constructor","http","dadosCarregados$","DATA_URL","carregarDados","get","pipe","dados","console","log","error","warn","getDadosFallback","subscribe","next","getDados","asObservable","getEscolasPorTipo","tipo","escolas","filter","escola","calcularMediasPorTipo","pei","e","regular","calcularMedia","campo","valores","v","undefined","isNaN","length","reduce","a","b","count","total","frequencia_media","rendimento_medio","aprovacao_media","plataformas_media","score_medio","getResumoRede","resumo_rede","total_escolas","escolas_pei","escolas_regulares","score_medio_geral","score_medio_pei","score_medio_regular","frequencia_media_rede","rendimento_medio_rede","aprovacao_media_rede","uso_plataformas_medio","engajamento_medio","id","nome","frequencia_1bi","frequencia_2bi","rendimento_1bi","rendimento_2bi","aprovacao","uso_plataformas","engajamento_docente","score_super_bi","classificacao","i0","ɵɵinject","i1","HttpClient","factory","ɵfac","providedIn"],"sources":["C:\\Users\\davi.silva\\Downloads\\Analise-REGINA-main\\src\\app\\services\\escola.service.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { Observable, BehaviorSubject, of } from 'rxjs';\r\nimport { map, catchError, tap } from 'rxjs/operators';\r\nimport { DadosEscolas, Escola, ResumoRede, MediasPorTipo } from '../models/escola.model';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class EscolaService {\r\n  private dadosCarregados$ = new BehaviorSubject<DadosEscolas | null>(null);\r\n  private readonly DATA_URL = 'assets/static/dados_escolas.json';\r\n\r\n  constructor(private http: HttpClient) {\r\n    this.carregarDados();\r\n  }\r\n\r\n  /**\r\n   * Carrega dados do JSON\r\n   */\r\n  carregarDados(): void {\r\n    this.http.get<DadosEscolas>(this.DATA_URL).pipe(\r\n      tap(dados => console.log('✅ Dados carregados:', dados)),\r\n      catchError(error => {\r\n        console.warn('⚠️ Erro ao carregar JSON, usando fallback:', error);\r\n        return of(this.getDadosFallback());\r\n      })\r\n    ).subscribe(dados => {\r\n      this.dadosCarregados$.next(dados);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Retorna observable dos dados\r\n   */\r\n  getDados(): Observable<DadosEscolas | null> {\r\n    return this.dadosCarregados$.asObservable();\r\n  }\r\n\r\n  /**\r\n   * Retorna escolas por tipo\r\n   */\r\n  getEscolasPorTipo(tipo?: 'PEI' | 'Regular'): Observable<Escola[]> {\r\n    return this.dadosCarregados$.pipe(\r\n      map(dados => {\r\n        if (!dados) return [];\r\n        if (!tipo) return dados.escolas;\r\n        return dados.escolas.filter(escola => escola.tipo === tipo);\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Calcula médias por tipo\r\n   */\r\n  calcularMediasPorTipo(): Observable<MediasPorTipo | null> {\r\n    return this.dadosCarregados$.pipe(\r\n      map(dados => {\r\n        if (!dados || !dados.escolas) return null;\r\n\r\n        const pei = dados.escolas.filter(e => e.tipo === 'PEI');\r\n        const regular = dados.escolas.filter(e => e.tipo === 'Regular');\r\n\r\n        const calcularMedia = (escolas: Escola[], campo: keyof Escola): number => {\r\n          const valores = escolas\r\n            .map(e => e[campo] as number)\r\n            .filter(v => v !== undefined && !isNaN(v));\r\n          return valores.length > 0 ? valores.reduce((a, b) => a + b, 0) / valores.length : 0;\r\n        };\r\n\r\n        return {\r\n          pei: {\r\n            count: pei.length,\r\n            total: pei.length,\r\n            escolas: pei,\r\n            frequencia_media: calcularMedia(pei, 'frequencia_2bi'),\r\n            rendimento_medio: calcularMedia(pei, 'rendimento_2bi'),\r\n            aprovacao_media: calcularMedia(pei, 'aprovacao'),\r\n            plataformas_media: calcularMedia(pei, 'uso_plataformas'),\r\n            score_medio: calcularMedia(pei, 'score_super_bi')\r\n          },\r\n          regular: {\r\n            count: regular.length,\r\n            total: regular.length,\r\n            escolas: regular,\r\n            frequencia_media: calcularMedia(regular, 'frequencia_2bi'),\r\n            rendimento_medio: calcularMedia(regular, 'rendimento_2bi'),\r\n            aprovacao_media: calcularMedia(regular, 'aprovacao'),\r\n            plataformas_media: calcularMedia(regular, 'uso_plataformas'),\r\n            score_medio: calcularMedia(regular, 'score_super_bi')\r\n          }\r\n        };\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Retorna resumo da rede\r\n   */\r\n  getResumoRede(): Observable<ResumoRede | null> {\r\n    return this.dadosCarregados$.pipe(\r\n      map(dados => dados?.resumo_rede || null)\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Dados de fallback caso o JSON não carregue\r\n   */\r\n  private getDadosFallback(): DadosEscolas {\r\n    return {\r\n      resumo_rede: {\r\n        total_escolas: 2,\r\n        escolas_pei: 1,\r\n        escolas_regulares: 1,\r\n        score_medio_geral: 83.3,\r\n        score_medio_pei: 86.7,\r\n        score_medio_regular: 79.8,\r\n        frequencia_media_rede: 90.0,\r\n        rendimento_medio_rede: 7.2,\r\n        aprovacao_media_rede: 84.3,\r\n        uso_plataformas_medio: 83.4,\r\n        engajamento_medio: 4.2\r\n      },\r\n      escolas: [\r\n        {\r\n          id: 'pei_edith_silveira',\r\n          nome: 'PEI EE Profª Edith Silveira Dalmaso',\r\n          tipo: 'PEI',\r\n          frequencia_1bi: 91.9,\r\n          frequencia_2bi: 93.0,\r\n          rendimento_1bi: 7.7,\r\n          rendimento_2bi: 7.6,\r\n          aprovacao: 87.8,\r\n          uso_plataformas: 90.0,\r\n          engajamento_docente: 4.5,\r\n          score_super_bi: 86.7,\r\n          classificacao: 'MUITO BOM'\r\n        },\r\n        {\r\n          id: 'ee_plinio_berardo',\r\n          nome: 'EE Profº Plínio Berardo',\r\n          tipo: 'Regular',\r\n          frequencia_1bi: 84.8,\r\n          frequencia_2bi: 87.0,\r\n          rendimento_1bi: 6.9,\r\n          rendimento_2bi: 6.8,\r\n          aprovacao: 80.9,\r\n          uso_plataformas: 76.7,\r\n          engajamento_docente: 3.8,\r\n          score_super_bi: 79.8,\r\n          classificacao: 'BOM'\r\n        }\r\n      ]\r\n    };\r\n  }\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}