<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador Super BI - Sistema REGINA 2025</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .card { transition: all 0.3s ease; }
        .card:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0,0,0,0.1); }
        .chart-container { position: relative; height: 300px; margin: 20px 0; }
        .range-slider {
            -webkit-appearance: none;
            appearance: none;
            height: 6px;
            border-radius: 3px;
            background: #e2e8f0;
            outline: none;
        }
        .range-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #3b82f6;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="gradient-bg text-white">
        <div class="container mx-auto px-6 py-8">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-3xl font-bold mb-2">üéØ Simulador Super BI Avan√ßado</h1>
                    <p class="text-lg opacity-90">Simule cen√°rios e projete resultados baseados no Super BI 2025</p>
                </div>
                <div class="text-right">
                    <div class="text-2xl font-bold">2025</div>
                    <p class="text-sm opacity-75">Sistema REGINA</p>
                </div>
            </div>
            <div class="mt-4">
                <a href="index.html" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-2 rounded-lg transition-colors">
                    ‚Üê Voltar ao Sistema
                </a>
            </div>
        </div>
    </header>

    <div class="container mx-auto px-6 py-8">
        <!-- Sele√ß√£o de Escola -->
        <section class="mb-8">
            <div class="bg-white p-6 rounded-lg shadow-md card">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">üè´ Selecionar Escola para Simula√ß√£o</h2>
                <div class="grid md:grid-cols-2 gap-4">
                    <select id="escolaSelect" class="border border-gray-300 rounded-lg px-3 py-2">
                        <option value="">Selecione uma escola...</option>
                    </select>
                    <button onclick="carregarEscola()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                        Carregar Dados da Escola
                    </button>
                </div>
                <div id="dadosEscolaAtual" class="mt-4 hidden">
                    <div class="grid md:grid-cols-4 gap-4 p-4 bg-gray-50 rounded-lg">
                        <div class="text-center">
                            <div id="escolaFreqAtual" class="text-lg font-bold text-blue-600">--</div>
                            <p class="text-xs text-gray-600">Freq. Atual</p>
                        </div>
                        <div class="text-center">
                            <div id="escolaRendAtual" class="text-lg font-bold text-green-600">--</div>
                            <p class="text-xs text-gray-600">Rend. Atual</p>
                        </div>
                        <div class="text-center">
                            <div id="escolaScoreAtual" class="text-lg font-bold text-purple-600">--</div>
                            <p class="text-xs text-gray-600">Score Atual</p>
                        </div>
                        <div class="text-center">
                            <div id="escolaTipo" class="text-lg font-bold text-orange-600">--</div>
                            <p class="text-xs text-gray-600">Tipo</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Controles do Simulador -->
        <section class="mb-8">
            <div class="bg-white p-6 rounded-lg shadow-md card">
                <h2 class="text-xl font-semibold text-gray-800 mb-6">‚öôÔ∏è Controles de Simula√ß√£o</h2>
                <div class="grid md:grid-cols-3 gap-6">
                    <!-- Frequ√™ncia -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            üìä Frequ√™ncia dos Alunos (%)
                        </label>
                        <input type="range" id="frequenciaSlider" min="70" max="100" value="85" 
                               class="range-slider w-full">
                        <div class="flex justify-between text-xs text-gray-500 mt-1">
                            <span>70%</span>
                            <span id="frequenciaValue" class="font-medium text-blue-600">85%</span>
                            <span>100%</span>
                        </div>
                    </div>

                    <!-- Rendimento -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            üìö Rendimento Acad√™mico
                        </label>
                        <input type="range" id="rendimentoSlider" min="5.0" max="10.0" step="0.1" value="7.5" 
                               class="range-slider w-full">
                        <div class="flex justify-between text-xs text-gray-500 mt-1">
                            <span>5.0</span>
                            <span id="rendimentoValue" class="font-medium text-green-600">7.5</span>
                            <span>10.0</span>
                        </div>
                    </div>

                    <!-- Aprova√ß√£o -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            ‚úÖ Taxa de Aprova√ß√£o (%)
                        </label>
                        <input type="range" id="aprovacaoSlider" min="70" max="100" value="85" 
                               class="range-slider w-full">
                        <div class="flex justify-between text-xs text-gray-500 mt-1">
                            <span>70%</span>
                            <span id="aprovacaoValue" class="font-medium text-purple-600">85%</span>
                            <span>100%</span>
                        </div>
                    </div>

                    <!-- Plataformas -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            üíª Uso de Plataformas (%)
                        </label>
                        <input type="range" id="plataformasSlider" min="50" max="100" value="75" 
                               class="range-slider w-full">
                        <div class="flex justify-between text-xs text-gray-500 mt-1">
                            <span>50%</span>
                            <span id="plataformasValue" class="font-medium text-orange-600">75%</span>
                            <span>100%</span>
                        </div>
                    </div>

                    <!-- Engajamento -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            üë• Engajamento Docente
                        </label>
                        <input type="range" id="engajamentoSlider" min="1.0" max="5.0" step="0.1" value="3.5" 
                               class="range-slider w-full">
                        <div class="flex justify-between text-xs text-gray-500 mt-1">
                            <span>1.0</span>
                            <span id="engajamentoValue" class="font-medium text-indigo-600">3.5</span>
                            <span>5.0</span>
                        </div>
                    </div>

                    <!-- Bot√µes de A√ß√£o -->
                    <div class="flex flex-col space-y-2">
                        <button onclick="resetarValores()" class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600">
                            üîÑ Resetar
                        </button>
                        <button onclick="aplicarCenarioOtimista()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700">
                            üìà Cen√°rio Otimista
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Resultados da Simula√ß√£o -->
        <section class="mb-8">
            <div class="grid lg:grid-cols-2 gap-6">
                <!-- Score Super BI -->
                <div class="bg-white p-6 rounded-lg shadow-md card">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">üéØ Score Super BI Projetado</h3>
                    <div class="text-center">
                        <div id="scoreProjetado" class="text-6xl font-bold text-blue-600 mb-4">82.5</div>
                        <div id="classificacaoProjetada" class="inline-block px-4 py-2 bg-blue-100 text-blue-800 rounded-full text-lg font-medium mb-4">
                            BOM
                        </div>
                        <div class="grid grid-cols-2 gap-4 text-sm">
                            <div>
                                <span class="text-gray-600">Melhoria:</span>
                                <span id="melhoriaScore" class="font-medium text-green-600">+0.0</span>
                            </div>
                            <div>
                                <span class="text-gray-600">Meta 90:</span>
                                <span id="distanciaMeta" class="font-medium text-orange-600">-7.5</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Radar Chart -->
                <div class="bg-white p-6 rounded-lg shadow-md card">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">üìä Radar de Componentes</h3>
                    <div class="chart-container">
                        <canvas id="radarSimulacao"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <!-- Gr√°ficos de An√°lise -->
        <section class="mb-8">
            <div class="grid lg:grid-cols-2 gap-6">
                <!-- Contribui√ß√£o por Componente -->
                <div class="bg-white p-6 rounded-lg shadow-md card">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">üìà Contribui√ß√£o por Componente</h3>
                    <div class="chart-container">
                        <canvas id="graficoContribuicao"></canvas>
                    </div>
                </div>

                <!-- Cen√°rios de Melhoria -->
                <div class="bg-white p-6 rounded-lg shadow-md card">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">üöÄ Cen√°rios de Melhoria</h3>
                    <div class="chart-container">
                        <canvas id="graficoCenarios"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <!-- Cen√°rios Pr√©-definidos -->
        <section class="mb-8">
            <div class="bg-white p-6 rounded-lg shadow-md card">
                <h2 class="text-xl font-semibold text-gray-800 mb-6">üìã Cen√°rios Pr√©-definidos</h2>
                <div class="grid md:grid-cols-3 gap-4">
                    <button onclick="aplicarCenario('conservador')" class="p-4 border-2 border-yellow-300 rounded-lg hover:bg-yellow-50">
                        <h4 class="font-medium text-yellow-800 mb-2">üü° Conservador</h4>
                        <p class="text-sm text-yellow-600">Melhorias graduais e sustent√°veis</p>
                    </button>
                    <button onclick="aplicarCenario('equilibrado')" class="p-4 border-2 border-blue-300 rounded-lg hover:bg-blue-50">
                        <h4 class="font-medium text-blue-800 mb-2">üîµ Equilibrado</h4>
                        <p class="text-sm text-blue-600">Crescimento moderado em todas as √°reas</p>
                    </button>
                    <button onclick="aplicarCenario('agressivo')" class="p-4 border-2 border-green-300 rounded-lg hover:bg-green-50">
                        <h4 class="font-medium text-green-800 mb-2">üü¢ Agressivo</h4>
                        <p class="text-sm text-green-600">Metas ambiciosas de excel√™ncia</p>
                    </button>
                </div>
            </div>
        </section>

        <!-- Recomenda√ß√µes -->
        <section class="mb-8">
            <div class="bg-white p-6 rounded-lg shadow-md card">
                <h2 class="text-xl font-semibold text-gray-800 mb-6">üí° Recomenda√ß√µes Baseadas na Simula√ß√£o</h2>
                <div id="recomendacoes" class="space-y-3">
                    <div class="bg-blue-50 p-3 rounded-lg border-l-4 border-blue-400">
                        <p class="text-sm text-blue-700">‚Ä¢ Configure os par√¢metros acima para ver recomenda√ß√µes personalizadas</p>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Scripts -->
    <script src="dados.js"></script>
    <script src="graficos.js"></script>
    <script>
        // Dados da simula√ß√£o
        let dadosSimulacao = {
            frequencia: 85,
            rendimento: 7.5,
            aprovacao: 85,
            plataformas: 75,
            engajamento: 3.5,
            scoreInicial: 82.5,
            escolaSelecionada: null
        };

        // Pesos do Super BI
        const pesos = {
            frequencia: 0.25,
            rendimento: 0.25,
            aprovacao: 0.25,
            plataformas: 0.15,
            engajamento: 0.10
        };

        let radarChart = null;
        let contribuicaoChart = null;
        let cenariosChart = null;

        // Inicializar p√°gina
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('üöÄ Inicializando simulador...');
            
            // Aguardar dados serem carregados
            await carregarDados();
            
            configurarEventListeners();
            atualizarSimulacao();
            popularSeletorEscolas('escolaSelect');
            inicializarGraficos();
            
            console.log('‚úÖ Simulador inicializado');
        });

        function configurarEventListeners() {
            const sliders = ['frequencia', 'rendimento', 'aprovacao', 'plataformas', 'engajamento'];
            sliders.forEach(slider => {
                document.getElementById(slider + 'Slider').addEventListener('input', atualizarSimulacao);
            });
        }

        function carregarEscola() {
            const escolaId = document.getElementById('escolaSelect').value;
            if (!escolaId) return;

            const escola = obterEscolaPorId(escolaId);
            if (!escola) return;

            dadosSimulacao.escolaSelecionada = escola;
            dadosSimulacao.scoreInicial = escola.score_super_bi;

            // Mostrar dados da escola
            document.getElementById('dadosEscolaAtual').classList.remove('hidden');
            document.getElementById('escolaFreqAtual').textContent = ((escola.frequencia_1bi + escola.frequencia_2bi) / 2).toFixed(1) + '%';
            document.getElementById('escolaRendAtual').textContent = ((escola.rendimento_1bi + escola.rendimento_2bi) / 2).toFixed(1);
            document.getElementById('escolaScoreAtual').textContent = escola.score_super_bi.toFixed(1);
            document.getElementById('escolaTipo').textContent = escola.tipo;

            // Configurar sliders com dados da escola
            document.getElementById('frequenciaSlider').value = (escola.frequencia_1bi + escola.frequencia_2bi) / 2;
            document.getElementById('rendimentoSlider').value = (escola.rendimento_1bi + escola.rendimento_2bi) / 2;
            document.getElementById('aprovacaoSlider').value = escola.aprovacao;
            document.getElementById('plataformasSlider').value = escola.uso_plataformas;
            document.getElementById('engajamentoSlider').value = escola.engajamento_docente;

            atualizarSimulacao();
        }

        function atualizarSimulacao() {
            // Obter valores dos sliders
            dadosSimulacao.frequencia = parseFloat(document.getElementById('frequenciaSlider').value);
            dadosSimulacao.rendimento = parseFloat(document.getElementById('rendimentoSlider').value);
            dadosSimulacao.aprovacao = parseFloat(document.getElementById('aprovacaoSlider').value);
            dadosSimulacao.plataformas = parseFloat(document.getElementById('plataformasSlider').value);
            dadosSimulacao.engajamento = parseFloat(document.getElementById('engajamentoSlider').value);

            // Atualizar displays dos valores
            document.getElementById('frequenciaValue').textContent = dadosSimulacao.frequencia.toFixed(0) + '%';
            document.getElementById('rendimentoValue').textContent = dadosSimulacao.rendimento.toFixed(1);
            document.getElementById('aprovacaoValue').textContent = dadosSimulacao.aprovacao.toFixed(0) + '%';
            document.getElementById('plataformasValue').textContent = dadosSimulacao.plataformas.toFixed(0) + '%';
            document.getElementById('engajamentoValue').textContent = dadosSimulacao.engajamento.toFixed(1);

            // Calcular novo score
            const novoScore = calcularScore();
            const melhoria = novoScore - dadosSimulacao.scoreInicial;

            // Atualizar displays do score
            document.getElementById('scoreProjetado').textContent = novoScore.toFixed(1);
            document.getElementById('melhoriaScore').textContent = (melhoria >= 0 ? '+' : '') + melhoria.toFixed(1);
            document.getElementById('distanciaMeta').textContent = (90 - novoScore).toFixed(1);

            // Atualizar classifica√ß√£o
            atualizarClassificacao(novoScore);

            // Atualizar gr√°ficos
            atualizarGraficos();

            // Gerar recomenda√ß√µes
            gerarRecomendacoes(novoScore);
        }

        function calcularScore() {
            return (dadosSimulacao.frequencia * pesos.frequencia) +
                   (dadosSimulacao.rendimento * 10 * pesos.rendimento) +
                   (dadosSimulacao.aprovacao * pesos.aprovacao) +
                   (dadosSimulacao.plataformas * pesos.plataformas) +
                   (dadosSimulacao.engajamento * 20 * pesos.engajamento);
        }

        function atualizarClassificacao(score) {
            let classificacao = 'INADEQUADO';
            let cor = 'bg-red-100 text-red-800';

            if (score >= 90) {
                classificacao = 'EXCELENTE';
                cor = 'bg-green-100 text-green-800';
            } else if (score >= 80) {
                classificacao = 'MUITO BOM';
                cor = 'bg-blue-100 text-blue-800';
            } else if (score >= 70) {
                classificacao = 'BOM';
                cor = 'bg-yellow-100 text-yellow-800';
            } else if (score >= 60) {
                classificacao = 'REGULAR';
                cor = 'bg-orange-100 text-orange-800';
            }

            const elemento = document.getElementById('classificacaoProjetada');
            elemento.textContent = classificacao;
            elemento.className = `inline-block px-4 py-2 rounded-full text-lg font-medium mb-4 ${cor}`;
        }

        function inicializarGraficos() {
            console.log('üéØ Inicializando gr√°ficos do simulador...');
            
            // Usar as fun√ß√µes do graficos.js
            if (typeof criarRadarSimulacao === 'function') {
                criarRadarSimulacao('radarSimulacao');
            }
            
            if (typeof criarGraficoContribuicao === 'function') {
                criarGraficoContribuicao('graficoContribuicao');
            }
            
            if (typeof criarGraficoCenarios === 'function') {
                criarGraficoCenarios('graficoCenarios');
            }
            
            console.log('‚úÖ Gr√°ficos do simulador inicializados');
        }

        function atualizarGraficos() {
            // Atualizar radar
            if (radarChart) {
                radarChart.data.datasets[0].data = [
                    dadosSimulacao.frequencia,
                    dadosSimulacao.rendimento * 10,
                    dadosSimulacao.aprovacao,
                    dadosSimulacao.plataformas,
                    dadosSimulacao.engajamento * 20
                ];
                radarChart.update();
            }
        }

        function resetarValores() {
            document.getElementById('frequenciaSlider').value = 85;
            document.getElementById('rendimentoSlider').value = 7.5;
            document.getElementById('aprovacaoSlider').value = 85;
            document.getElementById('plataformasSlider').value = 75;
            document.getElementById('engajamentoSlider').value = 3.5;
            atualizarSimulacao();
        }

        function aplicarCenarioOtimista() {
            document.getElementById('frequenciaSlider').value = 95;
            document.getElementById('rendimentoSlider').value = 9.0;
            document.getElementById('aprovacaoSlider').value = 95;
            document.getElementById('plataformasSlider').value = 90;
            document.getElementById('engajamentoSlider').value = 4.5;
            atualizarSimulacao();
        }

        function aplicarCenario(tipo) {
            const base = dadosSimulacao.escolaSelecionada ? {
                freq: (dadosSimulacao.escolaSelecionada.frequencia_1bi + dadosSimulacao.escolaSelecionada.frequencia_2bi) / 2,
                rend: (dadosSimulacao.escolaSelecionada.rendimento_1bi + dadosSimulacao.escolaSelecionada.rendimento_2bi) / 2,
                aprov: dadosSimulacao.escolaSelecionada.aprovacao,
                plat: dadosSimulacao.escolaSelecionada.uso_plataformas,
                eng: dadosSimulacao.escolaSelecionada.engajamento_docente
            } : {
                freq: 85, rend: 7.5, aprov: 85, plat: 75, eng: 3.5
            };

            let multiplicadores = {};
            
            switch(tipo) {
                case 'conservador':
                    multiplicadores = { freq: 1.02, rend: 1.05, aprov: 1.03, plat: 1.05, eng: 1.1 };
                    break;
                case 'equilibrado':
                    multiplicadores = { freq: 1.05, rend: 1.1, aprov: 1.06, plat: 1.1, eng: 1.15 };
                    break;
                case 'agressivo':
                    multiplicadores = { freq: 1.08, rend: 1.15, aprov: 1.1, plat: 1.15, eng: 1.2 };
                    break;
            }

            document.getElementById('frequenciaSlider').value = Math.min(100, base.freq * multiplicadores.freq);
            document.getElementById('rendimentoSlider').value = Math.min(10, base.rend * multiplicadores.rend);
            document.getElementById('aprovacaoSlider').value = Math.min(100, base.aprov * multiplicadores.aprov);
            document.getElementById('plataformasSlider').value = Math.min(100, base.plat * multiplicadores.plat);
            document.getElementById('engajamentoSlider').value = Math.min(5, base.eng * multiplicadores.eng);
            
            atualizarSimulacao();
        }

        function gerarRecomendacoes(score) {
            const container = document.getElementById('recomendacoes');
            container.innerHTML = '';

            const recomendacoes = [];

            if (dadosSimulacao.frequencia < 90) {
                recomendacoes.push({
                    tipo: 'warning',
                    texto: 'Frequ√™ncia abaixo de 90%. Implemente a√ß√µes para reduzir absente√≠smo.'
                });
            }

            if (dadosSimulacao.rendimento < 8.0) {
                recomendacoes.push({
                    tipo: 'info',
                    texto: 'Rendimento pode melhorar. Considere refor√ßo escolar e metodologias ativas.'
                });
            }

            if (dadosSimulacao.plataformas < 80) {
                recomendacoes.push({
                    tipo: 'warning',
                    texto: 'Intensifique o uso das plataformas BI. Ofere√ßa capacita√ß√£o aos professores.'
                });
            }

            if (score >= 90) {
                recomendacoes.push({
                    tipo: 'success',
                    texto: 'Excelente! Mantenha as pr√°ticas atuais e compartilhe experi√™ncias com outras escolas.'
                });
            }

            if (recomendacoes.length === 0) {
                recomendacoes.push({
                    tipo: 'info',
                    texto: 'Performance equilibrada. Continue monitorando e ajustando conforme necess√°rio.'
                });
            }

            recomendacoes.forEach(rec => {
                const cores = {
                    success: 'bg-green-50 border-green-400 text-green-700',
                    warning: 'bg-yellow-50 border-yellow-400 text-yellow-700',
                    info: 'bg-blue-50 border-blue-400 text-blue-700'
                };

                const div = document.createElement('div');
                div.className = `p-3 rounded-lg border-l-4 ${cores[rec.tipo]}`;
                div.innerHTML = `<p class="text-sm">‚Ä¢ ${rec.texto}</p>`;
                container.appendChild(div);
            });
        }
    </script>
</body>
</html>

